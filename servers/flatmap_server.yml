--- # Flatmap servers
Upgrading: &upgrade
  Commands: |
    # First stop server with ^C
    $ git fetch -t
    $ git checkout NEW-TAG
    $ poetry update
    $ poetry run mapviewer --bind 0.0.0.0:PORT

Servers:
  - Id: Development version 1
    Configuration: &devel_v1
      Comment: Promoted to production version 2
      Used by: https://mapcore-demo.org/staging/sparc-app/maps/
      Endpoint: https://mapcore-demo.org/devel/flatmap/v1/
      Endpoint: https://mapcore-demo.org/current/flatmap/v2/
      Port: 4330
      Tmux id: prod-flatmaps-v2
      Directory: /home/ubuntu/services/prod-flatmap-server-v2
      Release tag: v0.10.12
      Integrated viewer: v2.1.0b16
      Start up: |
        $ export BEARER_TOKENS=make_devel_map
        $ export SCICRUNCH_API_KEY=xBOrIfnZTvJQtobGo8XHRvThdMYGTxtf
        $ poetry run mapviewer --bind 0.0.0.0:4330
      Map generation: |
        $ curl -H "Content-Type: application/json"  \
          -H "Authorization: Bearer make_devel_map"  \
          -X POST \
          -d '{"source": “PATH_TO_MANIFEST”}'  \
          https://mapcore-demo.org/current/flatmap/v2/make/map
      Upgrading: *upgrade

  - Id: Development version 3
    Configuration:
      Used by: Development
      Endpoint: https://mapcore-demo.org/devel/flatmap/v3/
      Port: 4332
      Tmux id: dev-flatmaps-v3
      Directory: /home/ubuntu/services/dev-flatmap-server-v3
      Release tag: v0.10.15
      Integrated viewer: v2.2.0b11
      Start up: |
        $ export BEARER_TOKENS=make_devel_map
        $ export SCICRUNCH_API_KEY=xBOrIfnZTvJQtobGo8XHRvThdMYGTxtf
        $ poetry run mapviewer --bind 0.0.0.0:4332
      Map generation: |
        $ curl -H "Content-Type: application/json"  \
          -H "Authorization: Bearer make_devel_map"  \
          -X POST \
          -d '{"source": “PATH_TO_MANIFEST”}'  \
          https://mapcore-demo.org/devel/flatmap/v3/make/map
      Upgrading: *upgrade

  - Id: Staging
    Configuration:
      Endpoint: https://mapcore-demo.org/staging/flatmap/v1/
      Viewer: https://mapcore-demo.org/staging/flatmap/v1/viewer/
      Port: 4331
      Tmux id: staging-flatmap-server
      Directory: /home/ubuntu/services/staging-flatmap-server
      Release tag: v0.10.14
      Integrated viewer: v2.2.0b9
      Start up: |
        $ export SCICRUNCH_API_KEY=xBOrIfnZTvJQtobGo8XHRvThdMYGTxtf
        $ poetry run mapviewer --bind 0.0.0.0:4331
      Upgrading: *upgrade

  - Id: fCCB
    Configuration:
      Comment: fCCB staging site
      Used by:  https://mapcore-demo.org/staging/flatmap-update-sparc-app/
      Endpoint: https://mapcore-demo.org/fccb/flatmap/
      Viewer: https://mapcore-demo.org/fccb/flatmap/viewer/
      Port: 4333
      Tmux id: fccb-flatmap-server
      Directory: /home/ubuntu/services/staging-fccb-server
      Release tag: v0.10.13
      Integrated viewer: v2.1.0b16
      Start up: |
        $ export BEARER_TOKENS=make_fccb_map
        $ export SCICRUNCH_API_KEY=xBOrIfnZTvJQtobGo8XHRvThdMYGTxtf
        $ poetry run mapviewer --bind 0.0.0.0:4333
      Upgrading: *upgrade

  - Id: Production version 2
    Configuration:
      <<: *devel_v1
      Comment: Promoted from development version 1
      Used by: https://sparc.science/maps
      Endpoint: https://mapcore-demo.org/current/flatmap/v2/

  - Id: Production version 1
    Configuration:
      Used by: Legacy demo apps
      Endpoint: https://mapcore-demo.org/flatmaps/
      Port: 4329
      Tmux id: flatmaps
      Directory: /home/ubuntu/flatmap-server
      Release tag: v0.9.4
      Start up: $ pipenv run python src/server.py
